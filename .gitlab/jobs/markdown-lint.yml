# -----------------------
# üìù Lint Stage - Markdown
# -----------------------
Lint Markdown:
  stage: lint
  image: ghcr.io/astral-sh/uv:python3.12-bookworm-slim
  cache:
    key: "${CI_COMMIT_REF_SLUG}-uv-markdown"
    paths:
      - .venv/
  before_script:
    - echo "Installing dependencies with uv..."
    - uv sync --group dev
  script:
    - echo "Running markdown linting on documentation..."
    - uv run pymarkdown --config pyproject.toml scan docs/ README.md
    
  after_script:
    - |
      if [ $CI_JOB_STATUS == 'success' ]; then
        echo -e "\033[1;32m‚úÖ All markdown files are well-formatted!\033[0m"
      else
        echo -e "\033[1;33m‚ö†Ô∏è  Markdown formatting issues found. Please review the output above.\033[0m"
        echo -e "\033[1;33müìñ See docs/development/markdown-linting.md for guidance.\033[0m"
      fi
  allow_failure: true  # Documentation issues shouldn't block deployment
  rules:
    # Always run on merge requests
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    # Run on push when docs change
    - if: '$CI_PIPELINE_SOURCE == "push"'
      changes:
        - "docs/**/*.md"
        - "*.md"
        - "pyproject.toml"
      when: always
    # Manual option
    - when: manual
      allow_failure: true
